@startuml
skinparam backgroundColor white
skinparam activityBorderColor black
skinparam activityBackgroundColor #F5F5F5

|Passenger|
start

repeat
  |#E6F2FF|Call System|
  :Press Call Button (Up/Down);
  note right: Button turns red when activated
  
  |#FFF2E6|Dispatcher|
  :Evaluate elevator positions and routes;
  :Assign request to optimal elevator;
  
  |Passenger|
  :Wait for elevator arrival;
  
  |#D6EAF8|Elevator Control|
  if (Elevator arrives at requested floor?) then (yes)
    :Set elevator state to IDLE;
    :Change door state to OPENING;
    note right: Takes 1 second
    :Door enters OPEN state;
    :Reset call button to blue;
    
    |Passenger|
    :Enter elevator;
    
    |#CCFFCC|Floor Selection|
    :Select target floor;
    note right: Button turns red
    
    |#D6EAF8|Elevator Control|
    fork
      :Wait for 3 seconds;
      if (No action and Open button not held) then (yes)
        :Change door state to CLOSING;
        note right: Takes 1 second
        :Door enters CLOSED state;
      endif
      
    fork again
      :Press Door Open Button;
      if (Elevator is IDLE?) then (yes)
        :Change door state to OPENING;
        note right: Takes 1 second
        :Door enters OPEN state;
        :Door remains open while button held;
        :Reset door timer to 3s when released;
      endif
      
    fork again
      :Press Door Close Button;
      if (Door is OPEN or OPENING?) then (yes)
        :Change door state to CLOSING;
        note right: Takes 1 second
        :Door enters CLOSED state;
      endif
    end fork
    
    if (Door CLOSED and has target floor) then (yes)
      if (Direction to target) then (up)
        :Set elevator state to MOVING_UP;
      else (down)
        :Set elevator state to MOVING_DOWN;
      endif
      
      |#FFE6E6|Engine|
      :Update elevator position floor by floor;
      :Reach target floor;
      
      |#D6EAF8|Elevator Control|
      :Set elevator state to IDLE;
      :Change door state to OPENING;
      :Door enters OPEN state;
      :Reset floor button to blue;
      
      |Passenger|
      :Exit elevator;
    endif
  endif
  
repeat while (System running)

stop
@enduml